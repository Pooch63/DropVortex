"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function isTLSSocket(socket) {
    return socket.encrypted;
}
var deferToConnect = function(socket, fn) {
    var listeners;
    if (typeof fn === 'function') {
        var connect = fn;
        listeners = {
            connect: connect
        };
    } else {
        listeners = fn;
    }
    var hasConnectListener = typeof listeners.connect === 'function';
    var hasSecureConnectListener = typeof listeners.secureConnect === 'function';
    var hasCloseListener = typeof listeners.close === 'function';
    var onConnect = function() {
        if (hasConnectListener) {
            listeners.connect();
        }
        if (isTLSSocket(socket) && hasSecureConnectListener) {
            if (socket.authorized) {
                listeners.secureConnect();
            } else if (!socket.authorizationError) {
                socket.once('secureConnect', listeners.secureConnect);
            }
        }
        if (hasCloseListener) {
            socket.once('close', listeners.close);
        }
    };
    if (socket.writable && !socket.connecting) {
        onConnect();
    } else if (socket.connecting) {
        socket.once('connect', onConnect);
    } else if (socket.destroyed && hasCloseListener) {
        listeners.close(socket._hadError);
    }
};
exports.default = deferToConnect;
// For CommonJS default export support
module.exports = deferToConnect;
module.exports.default = deferToConnect;
